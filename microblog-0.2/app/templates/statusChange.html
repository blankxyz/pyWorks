<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>bugs status change</title>
    <script src="{{url_for('static', filename='jquery.js')}}"></script>
    <script type=text/javascript>
        var $SCRIPT_ROOT = {
        {
            request.script_root | tojson | safe
        }
        }
        ;
    </script>
    <script type=text/javascript>
        $(document).ready(function () {
            $("table1").blur(function () {
                var str = $(this).attr("id");
                var bugId = str.substr("tab_".length);
                var cnt = $("tr[id^=tr_c_" + bugId + "] > td").size() - 2;
                for (var i = 0; i < cnt; i++) {
                    $("td[id^=td_m_" + bugId + "_" + i + "]").toggle("fast");
                    $("td[id^=td_c_" + bugId + "_" + i + "]").toggle("fast");
                    $("td[id^=td_t_" + bugId + "_" + i + "]").toggle("slow");
                }
                <!-- set last info allow show -->
                if ($("td[id^=td_c_" + bugId + "_" + cnt + "]").text().search("CLOSED") > 0) {
                    color = "#aaaaaa";
                } else {
                    color = "#ffffff";
                }
                $("td[id^=td_m_" + bugId + "_" + cnt + "]").attr("bgcolor", color);
                $("td[id^=td_c_" + bugId + "_" + cnt + "]").attr("bgcolor", color);
                $("td[id^=td_t_" + bugId + "_" + cnt + "]").attr("bgcolor", color);
            });
            $("td_m").blur(function () {
                $.ajax({
                    type: 'POST',
                    url: url,
                    data: JSON.stringify({bugid: 34, when: '2015-10-10 15:48:57'}),
                    contentType: 'application/json'
                })
            });
        });
    </script>
    <script type=text/javascript>
        $(function () {
            function submit_form(e) {
                $.getJSON($SCRIPT_ROOT + '/add', {
                            a: $('input[name="a"]').val(),
                            b: $('input[name="b"]').val(),
                            now: new Date().getTime()
                        },
                        function (data) {
                            $('#result').text(data.result);
                        });
            };
            $('#calculate').bind('click', submit_form);
        });
    </script>
    <script type=text/javascript>
        $(function () {
            function getComment(e) {
                var str = $(this).attr("id");
                var bugId = str.substr("tab_".length);
                alert(bugId);
                $.getJSON($SCRIPT_ROOT + '/getComment', {
                            bugId: '34',
                            when: '2015-10-13 14:46:28',
                            now: new Date().getTime()
                        },
                        function (data) {
                            alert(data.result);
                        });
            };
            $('#td_m_34_1').bind('click', getComment);
        });
    </script>
</head>
<body>
<p>
    <input type=text size=20 name=a> +
    <input type=text size=20 name=b> =
    <span id=result>?</span>
</p>

<p><input type="button" id="calculate" value="计算"></p>

{% for change in changes %}
{% set bID = change.id %}
<div id="{{'div_' ~ bID}}" style="width:25%;margin-left:1px">
    <table id="{{'tab_' ~ bID }}" border="1" align="left" bgcolor="{{ loop.cycle('#7fffd4', '#87ceeb') }}" style="text-align:center;margin:2px;">
        <tr id="{{'tr_m_' ~ bID}}">
            <td><b>{{bID}}</b></td>
            <td><b>member</b></td>
            {% for c in change['change'] %}
            <td id="{{'td_m_' ~ bID ~ '_' ~ loop.index}}">{{c.member}}</td>
            {% endfor %}
        </tr>
        <tr id="{{'tr_c_' ~ bID}}">
            <td><b>{{bID}}</b></td>
            <td><b>changeTo</b></td>
            {% for c in change['change'] %}
            <td id="{{'td_c_' ~ bID ~ '_' ~ loop.index}}">{{c.changeTo}}</td>
            {% endfor %}
        </tr>
        <tr id="{{'tr_t_' ~ bID}}">
            <td><b>{{bID}}</b></td>
            <td><b>time</b></td>
            {% for c in change['change'] %}
            <td id="{{'td_t_' ~ bID ~ '_' ~ loop.index}}">{{c.time}}</td>
            {% endfor %}
        </tr>
    </table>
</div>
{% endfor %}
</body>
</html>