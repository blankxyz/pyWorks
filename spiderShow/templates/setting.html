<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>setting</title>
    <script src="{{ url_for('static', filename='jquery.min.js') }}"></script>
    <link href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
    <script type="text/javascript">
        var $SCRIPT_ROOT = {{ request.script_root | tojson | safe }};
        $(function () {
            function submit_form2(e) {
                $.ajax({url: $SCRIPT_ROOT + '/convert',
                        contentType: "application/json; charset=UTF-8",
                        dataType: 'json',
                        data:{
                            convert_url: $('input[id="convert_url"]').val(),
                            now: new Date().getTime()
                        },
                        error: function(xhr, err){ $('#regex_result').text(err); },
                        success: function(data, textStatus){ $('#regex_result').text(data.regex);}
                });
            };
            $('#convert').click(submit_form2);
        });
    </script>
    <!-- DataTables CSS -->
{#    <link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.7/css/jquery.dataTables.css">#}
{#    <style>#}
{#    .div-left{ float:left;width:49%;border:1px solid}#}
{#    .div-right{ float:left;width:49%;border:1px solid}#}
{#    </style>#}
    <!-- DataTables -->
{#    <script type="text/javascript" charset="utf8"#}
{#            src="http://cdn.datatables.net/1.10.7/js/jquery.dataTables.js"></script>#}
{#    <script type="text/javascript">#}
{#        $(document).ready(function () {#}
{#            var t = $('#detail-regex-tab').DataTable();#}
{#            $('#addRow').on('click', function () {#}
{#                t.row.add([#}
{#                    'rule1',#}
{#                    '<<',#}
{#                    'url'#}
{#                ]).draw();#}
{#            });#}
{#        });#}
{#    </script>#}
</head>
<body>
<h1 align="center">配置抓取信息
    <small>主页、域名、详情页/列表页URL的 关键字/正则表达式</small>
</h1>

<div id="message" class="form-group center" style="width:80%; margin-left:50px">
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul class=flashes>
            {% for message in messages %}
                <label>{{ message }}</label>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}
</div>

{#{{ myForm.errors }}#}
{##}
{#<form id="set" method="POST" action="/save_regex">#}
{#    <div class="input-group input-group-lg">#}
{#        <span class="input-group-addon">{{ myForm.regex1.label }}</span>#}
{#        <input type="text" class="form-control"#}
{#               placeholder="/[a-zA-Z]{1,}/[a-zA-Z]{1,}/\d{4}\/?\d{4}/\d{1,}.html">#}
{#    </div>#}
{#    <br>#}
{##}
{#    <div class="input-group input-group-lg">#}
{#        <span class="input-group-addon">{{ myForm.regex2.label }}</span>#}
{#        <input type="text" class="form-control"#}
{#               placeholder="/[a-zA-Z]{1,}/[a-zA-Z]{1,}/[0-9a-zA-Z]{1,}/\d{4}/?\d{4}/\d{1,}.html">#}
{#    </div>#}
{#    <br>#}
{##}
{#    <div class="input-group input-group-lg">#}
{#        <span class="input-group-addon">{{ myForm.regex3.label }}</span>#}
{#        <input type="text" class="form-control" #}
{#               placeholder="/[a-zA-Z]{1,}/[a-zA-Z]{1,}/[a-zA-Z]{1,}/[0-9a-zA-Z]{1,}/\d{4}/?\d{4}/\d{1,}.html">#}
{#    </div>#}
{#    <br>#}
{#    <div class="input-group input-group-lg">#}
{#       <span class="input-group-addon">#}
{#          <input type="checkbox">#}
{#       </span>#}
{#       <input type="text" class="form-control">#}
{#    </div>#}
{#    <br>#}
{#    <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">{{ myForm.submit.label }}</button>#}
{#    {{ myForm.submit() }}#}
{#</form>#}

{#<button id="addRow">添加一行</button>#}

<form id="setting" method="POST" action="/save_and_run">
    <hr/>
    <div id="config" class="form-group center" style="width:80%; margin-left:50px">
        {{ myForm.start_urls.label }} &nbsp;{{ myForm.start_urls(size=30) }}&nbsp;&nbsp;&nbsp;
        {{ myForm.site_domain.label }} &nbsp;{{ myForm.site_domain(size=20) }}
    </div>
    <hr/>
    <div id="list-keyword" class="form-group" style="width:80%; margin-left:50px">
        <label for="name">{{ myForm.list_keyword.label }} </label>&nbsp;{{ myForm.list_keyword(size=120) }}<br>
        <label for="name">{{ myForm.detail_keyword.label }}</label>&nbsp;{{ myForm.detail_keyword(size=120) }}
    </div>
    <hr/>

    <div id="convert-ajax" class="form-group" style="width:80%; margin-left:50px">
        <input type=text size=50 id="convert_url">&nbsp;<input type="button" id="convert" value="转换为正则">&nbsp;
        <label id="regex_result"> 请确认转换后的表达式，拷贝到下面列表中。 </label>
    </div>

    <hr/>
    <div id="detail-regex" class="form-group" style="width:80%; margin-left:50px">
        <label for="name">详情页-正则表达式</label><br>
{#        <table id="detail-regex-tab" bgcolor="{{ loop.cycle('Gainsboro', 'GhostWhite') }}">#}
        <table id="detail-regex-tab">
            <thead>
            <tr>
                <th>选择</th>
                <th>正则表达式</th>
                <th>匹配数</th>
            </tr>
            </thead>
            <tbody>
            {% for row in myForm.regex_list %}
                <tr id="{{ loop.index }}">
                    <td>&nbsp;&nbsp;{{ row.select() }}</td>
                    <td>{{ row.regex(size=100) }}</td>
                    <td>{{ row.score(size=6) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="reset" class="form-group checkbox" style="width:80%; margin-left:50px">
        <label>{{ myForm.reset }} {{ myForm.reset.label }}</label>
    </div>
    <div id="submit" class="form-group" style="width:80%; margin-left:50px">
        <button type="button" class="btn">{{ myForm.submit() }}</button>
    </div>
</form>

</body>
</html>